<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kenpo Flashcards (Web)</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="titleRow">
        <h1>Kenpo Flashcards</h1>
        <div class="mini" id="healthLine"></div>
        <div class="mini userBtn" id="userLine" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false"></div>
<div class="userMenu hidden" id="userMenu" role="menu" aria-label="User menu">
  <div class="userMenuRow"><span class="mutedSmall" id="userMenuVersion">Version: ‚Ä¶</span></div>
  <div class="userMenuRow userMenuAction" id="userMenuLogout">üö™ Logout</div>
  <div class="userMenuDivider"></div>
  <div class="userMenuRow"><a class="userMenuLink" href="/admin" id="userMenuAdmin">‚öôÔ∏è Admin</a></div>
  <div class="userMenuRow"><a class="userMenuLink" href="/about">‚ÑπÔ∏è About</a></div>
  <div class="userMenuRow"><a class="userMenuLink" href="/user-guide">üìñ User Guide</a></div>
</div>

      </div>

      <div class="tabs">
        <button class="tab active" id="tabActive">Unlearned</button>
        <button class="tab" id="tabUnsure">Unsure</button>
        <button class="tab" id="tabLearned">Learned</button>
        <button class="tab small" id="tabAll">All</button>
        <button class="tab small" id="tabCustom" title="Custom Set (starred cards)">‚≠ê</button>
        
        <!-- Learned page view toggle (only shown when Learned tab is active) -->
        <div class="tabsRight hidden" id="learnedViewToggle" aria-label="Learned view toggle">
          <button class="tab tiny" id="learnedViewListBtn" title="Learned: List view">List</button>
          <button class="tab tiny" id="learnedViewStudyBtn" title="Learned: Study view">Study</button>
        </div>
        
        <!-- Custom Set view toggle (only shown when Custom tab is active) -->
        <div class="tabsRight hidden" id="customViewToggle" aria-label="Custom Set view toggle">
          <button class="tab tiny active" id="customViewAllBtn" title="All Custom">All</button>
          <button class="tab tiny" id="customViewUnsureBtn" title="Unsure in Custom">Unsure</button>
          <button class="tab tiny" id="customViewLearnedBtn" title="Learned in Custom">Learned</button>
        </div>
      </div>

      <div class="counts" id="countsLine">Unlearned: ‚Äì | Unsure: ‚Äì | Learned: ‚Äì</div>

      <div class="controls">
        <div class="leftControls">
          <label class="field">
            <span>Study / Group</span>
            <select id="groupSelect" class="hiddenSelect" aria-hidden="true" tabindex="-1"></select>
            <div class="groupDropdown" id="groupDropdown">
              <button type="button" id="groupDropdownBtn" class="select" aria-haspopup="listbox" aria-expanded="false">Select group...</button>
              <div id="groupDropdownMenu" class="dropdownMenu hidden" role="listbox" aria-label="Select group"></div>
            </div>
          </label>

          <button id="allCardsBtn" class="secondary">All Cards</button>
        </div>

        <div class="rightControls">
          <input id="searchBox" placeholder="Search (term / meaning / pron)" />
          <button id="breakdownsBtn" class="secondary iconOnly" title="Breakdowns" aria-label="Breakdowns">üß©</button>
          <button id="settingsBtn" class="secondary">‚öôÔ∏è More</button>
        </div>
      </div>

      <div class="status" id="status"></div>
    </header>

    <main class="main">
      <!-- STUDY VIEW -->
      <section id="viewStudy" class="view">
        <div class="cardMeta">
          <div id="cardPos">Card ‚Äì / ‚Äì</div>
          <div class="randomRow hidden" id="randomStudyWrap">
            <span class="randomText">Random order</span>
            <label class="switch small" title="Toggle random order">
              <input type="checkbox" id="randomStudyChk" />
              <span class="slider"></span>
            </label>
            <button id="randomRefreshBtn" class="iconBtn" title="Reshuffle" aria-label="Reshuffle" style="display:none;">‚ü≥</button>
          </div>
        </div>

        <div class="card" id="card" tabindex="0" aria-label="Flashcard (click or Space to flip)">
          <div class="card-inner" id="cardInner">
            <div class="card-face front">
              <div class="pill" id="pillLabel"></div>
              <div class="big" id="frontText"></div>
              <div class="small" id="frontSub"></div>
              <div class="defExtras hidden" id="frontExtras"></div>
              <div class="hint">Click (or Space) to flip</div>
            </div>
            <div class="card-face back">
              <div class="pill">Back</div>
              <div class="big" id="backText"></div>
              <div class="small" id="backSub"></div>
              <div class="defExtras hidden" id="backExtras"></div>
              <div class="hint">Click (or Space) to flip back</div>
            </div>
          </div>
        </div>

        <div class="actionsRow">
          <button id="prevBtn" class="secondary">‚óÄ Prev</button>
          <button id="speakBtn" class="good">üîä Speak</button>
          <button id="starStudyBtn" class="secondary starBtn" title="Add to Custom Set">‚òÜ</button>
          <button id="nextBtn" class="secondary">Next ‚ñ∂</button>
          <button id="breakdownBtn" class="secondary iconOnly" title="Breakdown" aria-label="Breakdown">üß©</button>
        </div>

        <div class="actionsRow">
          <button id="gotItBtn" class="good">Got it ‚úì (mark learned)</button>
          <button id="unsureBtn" class="secondary">Unsure</button>
        </div>
      </section>

      <!-- LIST VIEWS -->
      <section id="viewList" class="view hidden">
        <div class="listHeader">
          <h2 id="listTitle">List</h2>
          <div class="listControls">
            <label class="field small" id="sortByStatusField" style="display:none;">
              <span>Sort by</span>
              <select id="sortByStatus">
                <option value="">Default order</option>
                <option value="unlearned">Unlearned first</option>
                <option value="unsure">Unsure first</option>
                <option value="learned">Learned first</option>
                <option value="alpha">Alphabetical</option>
              </select>
            </label>
          </div>
          <div class="bulkBtns" id="bulkBtns"></div>
        </div>
        <div id="list" class="list"></div>
      </section>

      <!-- SETTINGS VIEW -->
      <section id="viewSettings" class="view hidden">
        <div class="settingsPage">
          <h2>Settings</h2>
          
          <!-- Quick Nav Tabs -->
          <div class="settingsNav">
            <button class="settingsNavBtn active" data-section="study">üìö Study</button>
            <button class="settingsNavBtn" data-section="display">üé® Display</button>
            <button class="settingsNavBtn" data-section="voice">üîä Voice</button>
            <button class="settingsNavBtn" data-section="sync">üîÑ Sync</button>
            <button class="settingsNavBtn" data-section="ai">ü§ñ AI</button>
          </div>
          
          <!-- STUDY SECTION -->
          <div class="settingsSection active" id="settingsStudy" data-section="study">
            <div class="settingsCard">
              <div class="settingsCardHeader">üìö Study Behavior</div>
              
              <label class="field" style="margin-bottom: 12px;">
                <span>Settings scope</span>
                <select id="settingsScope"></select>
                <div class="helpText">Group settings override "All Groups".</div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setRandomize" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Randomize cards</div>
                  <div class="settingDesc">Shuffle the deck each time you start studying.</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setLinkRandomize" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Link random order across study tabs</div>
                  <div class="settingDesc">Changing Random order in one tab updates all study tabs.</div>
                </div>
              </label>
              
              <div class="settingsSectionTitle">Random order by tab</div>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setRandomizeUnlearned" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Unlearned: Random order</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setRandomizeUnsure" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Unsure: Random order</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setRandomizeLearnedStudy" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Learned Study: Random order</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setReverseFaces" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Reverse the cards (Definition first)</div>
                  <div class="settingDesc">Show the meaning on the front. Flip to see the term.</div>
                </div>
              </label>
            </div>
          </div>

          <!-- DISPLAY SECTION -->
          <div class="settingsSection" id="settingsDisplay" data-section="display">
            <div class="settingsCard">
              <div class="settingsCardHeader">üé® Display Options</div>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setShowGroup" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Show group label</div>
                  <div class="settingDesc">Display the group name pill on cards.</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setShowSubgroup" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Show subgroup label</div>
                  <div class="settingDesc">Show subgroup next to group in the pill.</div>
                </div>
              </label>

              <div class="settingsSectionTitle">Term Breakdown on Study Cards</div>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setShowBreakdownOnDef" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Show breakdown on definition side</div>
                  <div class="settingDesc">Display term breakdown on the back of the card.</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setBreakdownApplyAll" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Use one breakdown setting for all Study tabs</div>
                </div>
              </label>

              <label class="settingRow disabled" id="rowBreakdownRemoveAll">
                <span class="switch small"><input type="checkbox" id="setBreakdownRemoveAll" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">All tabs: Remove breakdown</div>
                </div>
              </label>

              <label class="settingRow" id="rowBreakdownRemoveUnlearned">
                <span class="switch small"><input type="checkbox" id="setBreakdownRemoveUnlearned" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Unlearned: Remove breakdown</div>
                </div>
              </label>

              <label class="settingRow" id="rowBreakdownRemoveUnsure">
                <span class="switch small"><input type="checkbox" id="setBreakdownRemoveUnsure" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Unsure: Remove breakdown</div>
                </div>
              </label>

              <label class="settingRow" id="rowBreakdownRemoveLearned">
                <span class="switch small"><input type="checkbox" id="setBreakdownRemoveLearned" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Learned Study: Remove breakdown</div>
                </div>
              </label>

              <div class="settingsSectionTitle">All-groups Ordering</div>

              <div class="settingSelect">
                <label class="field">
                  <span>All-groups mode</span>
                  <select id="setAllMode">
                    <option value="grouped">Grouped (by group)</option>
                    <option value="flat">Flat (mix all cards)</option>
                  </select>
                </label>

                <label class="field">
                  <span>Group order</span>
                  <select id="setGroupOrder">
                    <option value="alpha">Alphabetical</option>
                    <option value="json">As in JSON file</option>
                  </select>
                </label>

                <label class="field">
                  <span>Card order</span>
                  <select id="setCardOrder">
                    <option value="json">As in JSON file</option>
                    <option value="alpha">Alphabetical</option>
                  </select>
                </label>
              </div>

              <div class="settingsSectionTitle" id="listSettingsSection">List Page Settings</div>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setShowDefAllList" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Show definitions in All list</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setShowDefLearnedList" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Show definitions in Learned list</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setAllListShowUnlearnedUnsureBtns" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">All list: Show Unlearned/Unsure buttons</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setLearnedListShowMoveBtns" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Learned list: Show Relearn/Unsure buttons</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setLearnedListShowGroupLabel" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Learned list: Show group label</div>
                </div>
              </label>
            </div>
          </div>

          <!-- VOICE SECTION -->
          <div class="settingsSection" id="settingsVoice" data-section="voice">
            <div class="settingsCard">
              <div class="settingsCardHeader">üîä Speech Settings</div>

              <div class="settingSelect">
                <label class="field">
                  <span>Voice</span>
                  <select id="setSpeechVoice">
                    <option value="">Default voice</option>
                  </select>
                  <div class="helpText">Choose from available system voices.</div>
                </label>

                <label class="field">
                  <span>Speed: <span id="rateLabel">1x</span></span>
                  <input type="range" id="setSpeechRate" min="0.5" max="2" step="0.1" value="1" class="rangeInput" />
                  <div class="helpText">0.5x (slow) to 2x (fast).</div>
                </label>
              </div>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setAutoSpeakOnCardChange" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Auto-speak term on card change</div>
                  <div class="settingDesc">Speak the term when navigating cards.</div>
                </div>
              </label>

              <label class="settingRow">
                <span class="switch small"><input type="checkbox" id="setSpeakDefinitionOnFlip" /><span class="slider"></span></span>
                <div class="settingText">
                  <div class="settingTitle">Speak definition when flipped</div>
                  <div class="settingDesc">Speak the definition when card flips to back.</div>
                </div>
              </label>

              <div class="settingsBtnRow">
                <button id="resetVoiceBtn" class="appBtn secondary">Reset Voice</button>
                <button id="testVoiceBtn" class="appBtn primary">üîä Test Voice</button>
              </div>
            </div>
          </div>

          <!-- SYNC SECTION -->
          <div class="settingsSection" id="settingsSync" data-section="sync">
            <div class="settingsCard syncCard">
              <div class="loginStatusBanner" id="syncLoginStatus">
                <span class="statusIcon">‚úì</span>
                <div class="statusText">
                  <div class="statusTitle">Login Status: <span id="syncLoginLabel">Checking...</span></div>
                  <div class="statusSub" id="syncUserLabel">User: --</div>
                </div>
              </div>

              <div class="settingsCardHeader">üîÑ Web App Sync</div>
              <p class="settingDesc">Sync your study progress with the web server</p>
              <p class="syncLastTime">Last sync: <span id="syncLastTime">Never</span></p>

              <div class="syncInfoBox">
                <div class="syncInfoTitle">‚ö° Auto-Sync</div>
                <ul class="syncInfoList">
                  <li>First login always syncs automatically</li>
                  <li>Auto-pull on login: pulls latest progress when you log in</li>
                  <li>Auto-push on change: pushes updates whenever you mark a card</li>
                </ul>
              </div>

              <div class="syncSection">
                <div class="syncSectionTitle">Manual Sync</div>
                <p class="settingDesc">Push sends your progress to server. Pull downloads server progress to device.</p>
                <div class="settingsBtnRow">
                  <button id="syncPushBtn" class="appBtn primary">‚¨ÜÔ∏è Push</button>
                  <button id="syncPullBtn" class="appBtn primary">‚¨áÔ∏è Pull</button>
                </div>
              </div>

              <div class="syncDivider"></div>

              <div class="syncSection">
                <div class="syncSectionTitle">Sync Breakdowns</div>
                <p class="settingDesc">Download shared breakdowns from server</p>
                <button id="syncBreakdownsBtn" class="appBtn primary fullWidth">üß© Sync Breakdowns</button>
              </div>

              <div class="syncStatus" id="syncStatus"></div>
            </div>
          </div>

          <!-- AI SECTION -->
          <div class="settingsSection" id="settingsAI" data-section="ai">
            <div class="settingsCard">
              <div class="settingsCardHeader">ü§ñ AI Features</div>
              <p class="settingDesc">AI assists with breakdowns & card creation</p>

              <div class="settingSelect">
                <label class="field">
                  <span>Breakdown AI Provider</span>
                  <select id="setBreakdownProvider">
                    <option value="auto">Auto Select (Best Result)</option>
                    <option value="openai">OpenAI only</option>
                    <option value="gemini">Gemini only</option>
                    <option value="off">Off (built-in only)</option>
                  </select>
                  <div class="helpText" id="aiStatusLine">Status: checking‚Ä¶</div>
                </label>
              </div>

              <div class="aiStatusGrid" id="aiStatusGrid">
                <div class="aiStatusItem">
                  <span class="aiStatusLabel">ChatGPT:</span>
                  <span class="aiStatusValue" id="aiChatgptStatus">--</span>
                </div>
                <div class="aiStatusItem">
                  <span class="aiStatusLabel">Gemini:</span>
                  <span class="aiStatusValue" id="aiGeminiStatus">--</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Bottom Actions -->
          <div class="settingsBottomActions">
            <button id="resetSettingsBtn" class="appBtn danger">üîÑ Reset to Default</button>
            <button id="saveSettingsBtn" class="appBtn success">üíæ Save Settings</button>
            <button id="closeSettingsBtn" class="appBtn secondary">Close</button>
          </div>
        </div>
      </section>
    </main>
  </div>


  <!-- Breakdown modal -->
  <div class="modalOverlay hidden" id="breakdownOverlay">
    <div class="modalCard modalCardWide">
      <div class="modalHeaderRow">
        <h2 class="modalTitle" id="breakdownTitle">Breakdown</h2>
        <button class="secondary" id="breakdownCloseBtn">Close</button>
      </div>

      <div class="modalText" id="breakdownHelp">
        Break down compound terms into parts and save them (shared across all profiles).
      </div>

      <div class="modalBtns" style="justify-content:flex-start; gap:10px;">
        <button class="secondary" id="breakdownAutoBtn">Auto-fill</button>
        <button class="good" id="breakdownSaveBtn">Save</button>
      </div>

      <div class="breakdownGrid">
        <div class="breakdownCol">
          <div class="settingSectionTitle" style="margin-top:12px;">Parts</div>
          <div id="breakdownParts"></div>
          <div class="modalBtns" style="justify-content:flex-start; gap:10px;">
            <button class="secondary" id="breakdownAddPartBtn">+ Add part</button>
          </div>
        </div>

        <div class="breakdownCol">
          <div class="settingSectionTitle" style="margin-top:12px;">Literal meaning</div>
          <textarea id="breakdownLiteral" class="textarea" rows="3" placeholder="e.g., The Way of the Foot and Fist"></textarea>

          <div class="settingSectionTitle" style="margin-top:12px;">Notes (optional)</div>
          <textarea id="breakdownNotes" class="textarea" rows="3" placeholder="Anything else you want to remember..."></textarea>

          <div class="mini muted" id="breakdownMeta"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Breakdowns list (review) -->
  <div class="modalOverlay hidden" id="breakdownsOverlay">
    <div class="modalCard modalCardWide">
      <div class="modalHeaderRow">
        <h2 class="modalTitle">Saved Breakdowns</h2>
        <button class="secondary" id="breakdownsCloseBtn">Close</button>
      </div>

      <div class="row" style="gap:10px; align-items:center; margin:8px 0 12px 0;">
        <input id="breakdownsSearch" placeholder="Search breakdowns..." style="flex:1;" />
        <button id="breakdownsRefreshBtn" class="secondary">Refresh</button>
      </div>

      <div id="breakdownsList" class="breakdownsList"></div>
    </div>
  </div>

  <!-- Auth modal (Login/Register) -->
  <div class="modalOverlay hidden" id="authOverlay">
    <div class="modalCard">
      <h2 class="modalTitle">Kenpo Flashcards</h2>
      <div class="modalText" id="authMessage">Loading‚Ä¶</div>

      <!-- Login Form -->
      <div id="loginBox" class="hidden">
        <div class="modalForm">
          <label class="field">
            <span>Username</span>
            <input id="loginUsername" autocomplete="username" placeholder="Enter username" />
          </label>
          <label class="field">
            <span>Password</span>
            <input id="loginPassword" type="password" autocomplete="current-password" placeholder="Enter password" />
          </label>
        </div>
        <div class="modalBtns">
          <button class="appBtn success fullWidth" id="btnLogin">üîê Sign In</button>
        </div>
        <div class="modalDivider">
          <span>or</span>
        </div>
        <div class="modalBtns">
          <button class="appBtn secondary fullWidth" id="btnShowRegister">Create New Account</button>
        </div>
      </div>

      <!-- Register Form -->
      <div id="registerBox" class="hidden">
        <div class="modalForm">
          <label class="field">
            <span>Username</span>
            <input id="regUsername" autocomplete="username" placeholder="Choose a username (min 3 chars)" />
          </label>
          <label class="field">
            <span>Password</span>
            <input id="regPassword" type="password" autocomplete="new-password" placeholder="Choose a password (min 4 chars)" />
          </label>
          <label class="field">
            <span>Display Name (optional)</span>
            <input id="regDisplayName" autocomplete="name" placeholder="How you want to be shown" />
          </label>
        </div>
        <div class="modalBtns">
          <button class="appBtn success fullWidth" id="btnRegister">‚ú® Create Account</button>
        </div>
        <div class="modalDivider">
          <span>or</span>
        </div>
        <div class="modalBtns">
          <button class="appBtn secondary fullWidth" id="btnShowLogin">Back to Sign In</button>
        </div>
        <div class="modalFinePrint">
          Your progress syncs across all devices when you sign in with the same account.
        </div>
      </div>
    </div>
  </div>

  <script src="/app.js" defer></script>

</body>
</html>
